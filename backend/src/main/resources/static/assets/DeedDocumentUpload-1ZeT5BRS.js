import{r as i,l as x,m as _,p as w,b as T,c as l,a as s,F as g,k as v,q as C,s as E,v as F,d as c,u as R,o,t as y}from"./index-TAcQkgWd.js";const M={class:"max-w-3xl p-6 mx-auto space-y-4 bg-white shadow rounded-xl"},S={class:"mb-4"},U={class:"pl-5 text-sm text-gray-600 list-disc"},j={class:"mb-4"},q=["value"],B={class:"mb-4"},J={class:"flex justify-end gap-2 mt-6"},P=["disabled"],L={key:0},$={key:1},A={key:1,class:"mt-4 text-sm text-green-700"},V={__name:"DeedDocumentUpload",setup(G){const b=R(),d=i(),r=i([...d.deedDocs||[]]);x(()=>d,a=>{r.value=[...a.deedDocs||[]]},{immediate:!0});const m=_(()=>{if(!d||!d.deedType)return[];const a=w[d.deedType]||[],t=r.value.filter(e=>e.status!=="REJECTED").map(e=>e.docType);return a.filter(e=>!t.includes(e))}),u=i(null),n=i(""),p=i(!1),f=i([]),h=a=>{var e;const t=a.target;u.value=((e=t.files)==null?void 0:e[0])||null},D=async()=>{var t;const a=await c.get(`/deeds/${b.params.id}/status-history`);d.value=a.data,f.value=(t=a.data)==null?void 0:t.deedDocs},k=async()=>{if(!u.value||!n.value)return;p.value=!0;const a=new FormData;a.append("file",u.value),a.append("docType",n.value);const t=r.value.find(e=>e.docType===n.value&&e.status==="REJECTED");try{if(t)await c.put(`/deed-documents/${t.id}`,a,{headers:{"Content-Type":"multipart/form-data"}}),t.status="UPLOADED",t.name=u.value.name;else{const e=await c.post(`/deeds/${props.deed.id}/upload`,a,{headers:{"Content-Type":"multipart/form-data"}});r.value.push({id:e.data.id,docType:n.value,status:e.data.status||"UPLOADED",name:u.value.name})}alert("Dokumen berhasil diunggah."),props.onClose()}catch(e){console.error("Gagal unggah dokumen:",e),alert("Gagal mengunggah dokumen.")}finally{p.value=!1}};return T(D),(a,t)=>(o(),l("div",M,[s("div",S,[t[2]||(t[2]=s("p",{class:"mb-1 font-medium text-gray-700"},"Dokumen Wajib:",-1)),s("ul",U,[(o(!0),l(g,null,v(m.value,e=>(o(),l("li",{key:e},y(e),1))),128))])]),m.value.length>0?(o(),l("form",{key:0,onSubmit:C(k,["prevent"])},[s("div",j,[t[4]||(t[4]=s("label",{class:"block text-sm font-medium text-gray-700"},"Jenis Dokumen",-1)),E(s("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>n.value=e),class:"block w-full p-2 mt-1 border rounded"},[t[3]||(t[3]=s("option",{disabled:"",value:""},"-- Pilih Jenis Dokumen --",-1)),(o(!0),l(g,null,v(m.value,e=>(o(),l("option",{key:e,value:e},y(e),9,q))),128))],512),[[F,n.value]])]),s("div",B,[t[5]||(t[5]=s("label",{class:"block text-sm font-medium text-gray-700"},"Pilih File",-1)),s("input",{type:"file",onChange:h,class:"block w-full p-2 mt-1 border rounded"},null,32)]),s("div",J,[s("button",{type:"button",onClick:t[1]||(t[1]=(...e)=>a.onClose&&a.onClose(...e)),class:"px-4 py-2 text-gray-700 bg-gray-200 rounded hover:bg-gray-300"}," Batal "),s("button",{type:"submit",class:"px-4 py-2 text-white bg-blue-600 rounded hover:bg-blue-700",disabled:!u.value||!n.value||p.value},[p.value?(o(),l("span",L,"Mengunggah...")):(o(),l("span",$,"Unggah"))],8,P)])],32)):(o(),l("p",A," Semua dokumen wajib telah diunggah. "))]))}};export{V as default};

import{r as p,c as a,o as s,a as e,h as G,F as M,k as F,t as c,j as O,n as z,e as f,_ as W,s as R,x as N,p as J,d as U,y as Z,b as X,z as D,f as A,w as H,u as Q,B as Y,i as ee,C as V}from"./index-CHh2wL-8.js";import{_ as te}from"./PreviewDocument--8STOp-v.js";const se={class:"p-2"},ae={class:"flex flex-wrap gap-3"},le={class:"font-semibold"},oe={class:"text-sm"},ne={class:"flex gap-2"},re=["onClick"],de=["onClick"],ue={__name:"DeedUserDocument",props:{documents:{id:{required:!0},docType:{required:!0},name:{required:!0},status:{required:!0},filePath:{required:!0}}},emits:["reupload"],setup(T,{emit:h}){const x=p("http://localhost:8085"),l=h,i=p(""),y=v=>{l("reupload",v)},u=v=>{const d=`${x.value}/${v.name}`;i.value=d,console.log(" previewUrl ",i.value)},_=v=>{switch(v){case"APPROVED":return"text-green-600 font-semibold";case"REJECTED":return"text-red-600 font-semibold";case"PENDING":return"text-yellow-600 font-semibold";default:return"text-gray-600"}};return(v,d)=>(s(),a("div",se,[d[2]||(d[2]=e("h3",{class:"mb-4 text-lg font-bold"},"Daftar Dokumen",-1)),e("div",ae,[(s(!0),a(M,null,F(T.documents,m=>(s(),a("div",{key:m.id,class:"flex-grow w-full p-2 border border-gray-400 sm:w-auto rounded-2xl"},[e("div",null,[e("p",le,c(m.docType),1),e("p",oe,[d[1]||(d[1]=O(" Status: ")),e("span",{class:z(_(m.status))},c(m.status),3)])]),e("div",ne,[e("button",{onClick:k=>u(m),class:"text-blue-600 underline"},"Lihat",8,re),m.status==="REJECTED"?(s(),a("button",{key:0,onClick:k=>y(m),class:"px-2 py-1 text-sm text-white bg-yellow-500 rounded hover:bg-yellow-600"}," Unggah Ulang ",8,de)):f("",!0)])]))),128))]),G(te,{"preview-url":i.value,onClose:d[0]||(d[0]=m=>i.value="")},null,8,["preview-url"])]))}},ie={class:"w-full"},pe={key:0,class:"flex flex-col gap-3 mb-4"},ce={class:"flex flex-col"},me=["disabled"],ve={class:"flex flex-col"},be=["disabled"],ge={class:"flex items-center gap-2 mb-3"},xe=["disabled"],fe={key:0},ye={key:1},ke={key:1,class:"ml-2 text-sm text-yellow-700"},_e={key:1,class:"mt-1 text-sm text-red-500"},he={key:2,class:"mt-1 text-sm text-green-500"},we={key:3,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-gray-600 bg-opacity-50"},Ee={class:"w-full max-w-md p-8 bg-white rounded-lg shadow-xl"},Se={class:"mb-4"},Te=["disabled"],$e={class:"flex justify-end space-x-3"},De=["disabled"],Ae=["disabled"],Ce={key:0},Re={key:1},Ne={key:0,class:"mt-3 text-sm text-red-500"},Pe={key:1,class:"mt-3 text-sm text-green-500"},Ie={__name:"SetDeedOnProgress",props:{deed:{type:Object,required:!0}},emits:["saved"],setup(T,{emit:h}){const x=T,l=h,i=p(null),y=p(""),u=p(!1),_=p(null),v=p(null),d=p(!1),m=p(""),k=p(!1),w=p(null),n=p(null),t=b=>{var C;if(!b||!b.deedType||!J[b.deedType])return!1;const o=J[b.deedType]||[],r=((C=x.deed)==null?void 0:C.deedDocs)||[];if(o.length===0)return!0;const E=r.filter(S=>S.status==="APPROVED").map(S=>S.docType);return o.every(S=>E.includes(S))},$=()=>{m.value="",w.value=null,n.value=null,d.value=!0},P=()=>{d.value=!1},I=async()=>{var b,o;w.value=null,n.value=null,k.value=!0;try{const r={status:"REJECTED",note:m.value||"Akta ditolak tanpa catatan spesifik."},E=await U.put(`/deeds/${x.deed.id}/status`,r,{withCredentials:!0});l("saved",E.data),n.value="Akta berhasil ditolak.",d.value=!1}catch(r){console.error("Error rejecting deed:",r),w.value="Terjadi error saat menolak akta: "+(((o=(b=r.response)==null?void 0:b.data)==null?void 0:o.message)||r.message||"Unknown error")}finally{k.value=!1}},j=async()=>{var b,o;if(_.value=null,v.value=null,u.value=!0,!i.value){_.value="Nomor akta tidak boleh kosong.",u.value=!1;return}try{const r={status:"IN_PROGRESS",note:y.value||"Dokumen telah diverifikasi dan akta sedang diproses.",number:i.value},E=await U.put(`/deeds/${x.deed.id}/set-on-progress`,r);l("saved",E.data),v.value="Akta berhasil diproses dan status diatur IN_PROGRESS.",i.value=null,y.value=""}catch(r){console.error("Error processing deed:",r),_.value="Terjadi error saat memproses akta: "+(((o=(b=r.response)==null?void 0:b.data)==null?void 0:o.message)||r.message||"Unknown error")}finally{u.value=!1}};return(b,o)=>(s(),a("div",ie,[t(T.deed)?(s(),a("div",pe,[e("div",ce,[o[3]||(o[3]=e("label",{for:"deedNumber",class:"mb-1 text-sm text-gray-600"},"Nomor Akta:",-1)),R(e("input",{type:"number",id:"deedNumber","onUpdate:modelValue":o[0]||(o[0]=r=>i.value=r),placeholder:"Masukkan Nomor Akta",class:"w-full p-2 border rounded",disabled:u.value},null,8,me),[[N,i.value]])]),e("div",ve,[o[4]||(o[4]=e("label",{for:"processNote",class:"mb-1 text-sm text-gray-600"},"Catatan Proses (opsional):",-1)),R(e("textarea",{id:"processNote","onUpdate:modelValue":o[1]||(o[1]=r=>y.value=r),placeholder:"Catatan untuk proses (opsional)",class:"w-full p-2 border rounded",rows:"2",disabled:u.value},null,8,be),[[N,y.value]])])])):f("",!0),e("div",ge,[e("button",{onClick:$,class:"px-4 py-2 text-white bg-red-600 rounded shrink-0"}," Reject Akta "),t(T.deed)?(s(),a("button",{key:0,onClick:j,class:"px-4 py-2 text-white bg-green-600 rounded shrink-0",disabled:!i.value||u.value},[u.value?(s(),a("span",ye,"Memproses...")):(s(),a("span",fe,"Proses Akta"))],8,xe)):(s(),a("p",ke," Verifikasi semua dokumen untuk memproses akta. "))]),_.value?(s(),a("p",_e,c(_.value),1)):f("",!0),v.value?(s(),a("p",he,c(v.value),1)):f("",!0),d.value?(s(),a("div",we,[e("div",Ee,[o[6]||(o[6]=e("h3",{class:"mb-4 text-xl font-bold text-gray-800"},"Tolak Akta",-1)),e("div",Se,[o[5]||(o[5]=e("label",{for:"rejectNote",class:"block mb-2 text-sm font-bold text-gray-700"},"Catatan Penolakan (opsional):",-1)),R(e("textarea",{id:"rejectNote","onUpdate:modelValue":o[2]||(o[2]=r=>m.value=r),class:"w-full px-3 py-2 leading-tight text-gray-700 border rounded shadow appearance-none focus:outline-none focus:shadow-outline",rows:"3",placeholder:"Cth: Dokumen KTP tidak jelas, mohon diunggah ulang.",disabled:k.value},null,8,Te),[[N,m.value]])]),e("div",$e,[e("button",{onClick:P,class:"px-4 py-2 font-semibold text-gray-800 bg-gray-300 rounded-lg hover:bg-gray-400",disabled:k.value}," Batal ",8,De),e("button",{onClick:I,disabled:k.value,class:"px-4 py-2 font-semibold text-white bg-red-600 rounded-lg hover:bg-red-700 disabled:opacity-50"},[k.value?(s(),a("span",Re,"Menolak...")):(s(),a("span",Ce,"Tolak"))],8,Ae)]),w.value?(s(),a("p",Ne,c(w.value),1)):f("",!0),n.value?(s(),a("p",Pe,c(n.value),1)):f("",!0)])])):f("",!0)]))}},je=W(Ie,[["__scopeId","data-v-6fda52f7"]]),Oe={__name:"DeedComplete",props:{deed:{type:Object,required:!0}},emits:["open-invoice-form"],setup(T,{emit:h}){return(x,l)=>(s(),a("div",null,l[0]||(l[0]=[e("p",{class:"mb-4 text-base font-normal text-gray-700"},"Akta ini sudah selesai.",-1)])))}},Ue={class:"flex items-center gap-3 mb-4"},Ve={key:0,class:"py-4 text-center"},Ge={key:1,class:"flex gap-8 px-6 py-4 bg-white rounded-lg"},Me={class:"w-2/3 border-gray-300 border-e-2"},Fe={key:0,class:"mb-6"},qe={class:"grid grid-cols-[auto_auto_1fr] gap-y-3 gap-x-2"},Be={class:"flex justify-start"},Le={class:"px-2 py-1 font-bold text-white bg-green-300 rounded"},Je={class:"px-4 pt-4 pb-2 mr-3 border border-gray-200 border-1"},He={key:0},Ke={key:0},ze={key:1},We={class:"flex flex-wrap items-center gap-3 mb-4"},Ze={key:2},Xe={key:3},Qe={key:4},Ye={key:5},et={class:"w-1/3 pl-3"},tt={class:"relative border-gray-200 border-s dark:border-gray-700"},st={class:"mb-1 text-lg font-semibold text-gray-900 dark:text-white"},at={class:"block mb-2 text-sm font-bold leading-none text-gray-700 dark:text-gray-300"},lt={class:"text-base font-normal text-gray-500 dark:text-gray-400"},rt={__name:"DeedDetail",setup(T){const h=Z(),x=Q(),l=p(null),i=p(""),y=p(!0),u=["DRAFT","IN_PROGRESS","WAITING_SIGNATURE","COMPLETED","REJECTED"],_={DRAFT:"DRAFT",IN_PROGRESS:"SEDANG PROSES",WAITING_SIGNATURE:"MENUNGGU TANDA TANGAN",COMPLETED:"KOMPLET",REJECTED:"DITOLAK"},v=n=>_[n]||n,d=p([]),m=async n=>{l.value=n,d.value=(n==null?void 0:n.deedDocs)||[]},k=async()=>{var n;y.value=!0;try{const t=await U.get(`/deeds/${x.params.id}/status-history`);l.value=t.data,d.value=((n=t.data)==null?void 0:n.deedDocs)||[]}catch(t){console.error("Error fetching deed detail:",t),alert("Gagal mengambil detail akta.")}finally{y.value=!1}},w=async n=>{try{const t={status:n,note:i.value},$=await U.put(`/deeds/${x.params.id}/status`,t,{withCredentials:!0});alert("Status berhasil diperbarui!"),l.value=$.data,i.value=""}catch(t){console.error("Error updating deed status:",t),alert("Gagal memperbarui status akta.")}};return X(k),(n,t)=>{var P,I,j,b,o,r,E,C,S,q,B,L;const $=ee("router-link");return s(),a("div",null,[e("div",Ue,[t[6]||(t[6]=e("h2",{class:"w-10/12 text-2xl font-semibold"},"Detail Akta",-1)),((P=l.value)==null?void 0:P.deedStatus)==="DRAFT"&&A(h).isUser?(s(),D($,{key:0,to:{name:"EditAktaForm",params:{id:A(x).params.id}},class:"px-4 py-2 text-sm text-white bg-blue-400 rounded-md"},{default:H(()=>t[4]||(t[4]=[O(" Edit ")])),_:1,__:[4]},8,["to"])):f("",!0),A(h).isAdmin&&(((I=l.value)==null?void 0:I.deedStatus)===u[0]||((j=l.value)==null?void 0:j.deedStatus)===u[4])&&d.value.length>0?(s(),D($,{key:1,to:`/operator/deeds/${A(x).params.id}/review-documents`,class:"px-4 py-2 text-sm text-white bg-green-500 rounded-md"},{default:H(()=>t[5]||(t[5]=[O(" Verifikasi Dokumen ")])),_:1,__:[5]},8,["to"])):f("",!0)]),y.value?(s(),a("div",Ve,t[7]||(t[7]=[e("span",{class:"inline-block w-6 h-6 border-4 border-blue-400 rounded-full animate-spin border-t-transparent"},null,-1),e("p",{class:"mt-2 text-sm text-gray-500"},"Memuat data ...",-1)]))):(s(),a("div",Ge,[e("div",Me,[l.value?(s(),a("div",Fe,[e("div",qe,[t[8]||(t[8]=e("p",{class:"font-semibold text-left"},"Nomor Akta",-1)),t[9]||(t[9]=e("p",null,":",-1)),e("p",null,c(l.value.number||"Belum ada nomor"),1),t[10]||(t[10]=e("p",{class:"font-semibold text-left"},"Judul",-1)),t[11]||(t[11]=e("p",null,":",-1)),e("p",null,c(l.value.title),1),t[12]||(t[12]=e("p",{class:"font-semibold text-left"},"Jenis",-1)),t[13]||(t[13]=e("p",null,":",-1)),e("p",null,c(l.value.deedType),1),t[14]||(t[14]=e("p",{class:"font-semibold text-left"},"Deskripsi",-1)),t[15]||(t[15]=e("p",null,":",-1)),e("p",null,c(l.value.description),1),t[16]||(t[16]=e("p",{class:"font-semibold text-left"},"Tanggal",-1)),t[17]||(t[17]=e("p",null,":",-1)),e("p",null,c(A(Y)(l.value.deedDate)),1),t[18]||(t[18]=e("p",{class:"font-semibold text-left"},"Status Saat Ini",-1)),t[19]||(t[19]=e("p",null,":",-1)),e("div",Be,[e("span",Le,c(v(l.value.deedStatus)),1)])])])):f("",!0),e("div",Je,[A(h).isAdmin?(s(),a("div",He,[((b=l.value)==null?void 0:b.deedStatus)===u[0]&&d.value.length<1?(s(),a("div",Ke," Menunggu klien mengupload dokumen ")):(((o=l.value)==null?void 0:o.deedStatus)===u[0]||((r=l.value)==null?void 0:r.deedStatus)===u[4])&&d.value.length>0?(s(),a("div",ze,[e("div",We,[(s(!0),a(M,null,F(d.value,g=>(s(),a("button",{key:g.id,class:"flex items-center gap-2 px-4 py-2 border border-gray-400 rounded",disabled:""},[O(c(g.docType)+" ",1),g.status==="APPROVED"?(s(),D(V(n.CheckCircle),{key:0,class:"text-green-900"})):g.status==="REJECTED"?(s(),D(V(n.XCircle),{key:1,class:"text-red-800"})):(s(),D(V(n.FileText),{key:2}))]))),128))]),G(je,{deed:l.value,onSaved:m},null,8,["deed"])])):((E=l.value)==null?void 0:E.deedStatus)===u[1]?(s(),a("div",Ze,[t[20]||(t[20]=e("h4",{class:"mb-3 text-lg font-medium text-gray-900"}," Siap untuk Proses Tanda Tangan ",-1)),R(e("textarea",{"onUpdate:modelValue":t[0]||(t[0]=g=>i.value=g),placeholder:"Catatan perubahan status (opsional)",class:"w-full p-2 mb-3 border rounded"},null,512),[[N,i.value]]),e("button",{onClick:t[1]||(t[1]=g=>w("WAITING_SIGNATURE")),class:"px-4 py-2 text-white bg-green-600 rounded disabled:opacity-50 disabled:cursor-not-allowed"}," Proses Tanda Tangan ")])):((C=l.value)==null?void 0:C.deedStatus)===u[2]?(s(),a("div",Xe,[t[21]||(t[21]=e("h3",{class:"mb-3 text-lg font-medium text-gray-900"},"Selesaikan Proses Akta",-1)),R(e("textarea",{"onUpdate:modelValue":t[2]||(t[2]=g=>i.value=g),placeholder:"Catatan perubahan status (opsional)",class:"w-full p-2 mb-3 border rounded"},null,512),[[N,i.value]]),e("button",{onClick:t[3]||(t[3]=g=>w("COMPLETED")),class:"px-4 py-2 text-white bg-green-600 rounded"}," Selesaikan Akta ")])):((S=l.value)==null?void 0:S.deedStatus)===u[3]?(s(),a("div",Qe,[G(Oe,{deed:l.value,onOpenInvoiceForm:n.openInvoiceForm},null,8,["deed","onOpenInvoiceForm"])])):((q=l.value)==null?void 0:q.deedStatus)===u[4]?(s(),a("div",Ye," Akta ini DITOLAK. ")):f("",!0)])):(s(),D(ue,{key:1,documents:(B=l.value)==null?void 0:B.deedDocs},null,8,["documents"]))])]),e("div",et,[t[23]||(t[23]=e("h3",{class:"mb-2 text-xl font-medium"},"Riwayat Status",-1)),e("ol",tt,[(s(!0),a(M,null,F((L=l.value)==null?void 0:L.statusHistories,(g,K)=>(s(),a("li",{key:K,class:"pb-4 ms-6"},[t[22]||(t[22]=e("span",{class:"absolute flex items-center justify-center w-6 h-6 bg-blue-100 rounded-full -start-3 ring-8 ring-white dark:ring-gray-900 dark:bg-blue-900"},[e("svg",{class:"w-2.5 h-2.5 text-blue-800 dark:text-blue-300","aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{d:"M20 4a2 2 0 0 0-2-2h-2V1a1 1 0 0 0-2 0v1h-3V1a1 1 0 0 0-2 0v1H6V1a1 1 0 0 0-2 0v1H2a2 2 0 0 0-2 2v2h20V4ZM0 18a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8H0v10Zm5-8h10a1 1 0 0 1 0 2H5a1 1 0 0 1 0-2Z"})])],-1)),e("h3",st,c(v(g.status)),1),e("time",at,c(new Date(g.updatedAt).toLocaleString()),1),e("p",lt,c(g.note),1)]))),128))])])]))])}}};export{rt as default};

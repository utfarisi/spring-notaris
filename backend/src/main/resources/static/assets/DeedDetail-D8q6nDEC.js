import{h as K,r as g,c as l,a as e,i as G,F as M,l as F,t as p,k as O,n as z,e as y,o as s,_ as W,v as A,y as R,q as J,d as U,z as Z,b as X,A as $,f as C,w as q,u as Q,j as Y,B as ee,C as V}from"./index-CG5ay_Ty.js";import{_ as te}from"./PreviewDocument.vue_vue_type_script_setup_true_lang-6zeFZ4rn.js";const se={class:"p-2"},ae={class:"flex flex-wrap gap-3"},le={class:"font-semibold"},oe={class:"text-sm"},ne={class:"flex gap-2"},re=["onClick"],de=["onClick"],ue=K({__name:"DeedUserDocument",props:{documents:{}},emits:["reupload"],setup(T,{emit:h}){const x="https://spring-notaris-production.up.railway.app",a=h,u=g(""),i=d=>{a("reupload",d)},f=d=>{const c=`${x}/${d.name}`;u.value=c,console.log(" previewUrl ",u.value)},_=d=>{switch(d){case"APPROVED":return"text-green-600 font-semibold";case"REJECTED":return"text-red-600 font-semibold";case"PENDING":return"text-yellow-600 font-semibold";default:return"text-gray-600"}};return(d,c)=>(s(),l("div",se,[c[2]||(c[2]=e("h3",{class:"mb-4 text-lg font-bold"},"Daftar Dokumen",-1)),e("div",ae,[(s(!0),l(M,null,F(d.documents,m=>(s(),l("div",{key:m.id,class:"flex-grow w-full p-2 border border-gray-400 sm:w-auto rounded-2xl"},[e("div",null,[e("p",le,p(m.docType),1),e("p",oe,[c[1]||(c[1]=O(" Status: ")),e("span",{class:z(_(m.status))},p(m.status),3)])]),e("div",ne,[e("button",{onClick:k=>f(m),class:"text-blue-600 underline"},"Lihat",8,re),m.status==="REJECTED"?(s(),l("button",{key:0,onClick:k=>i(m),class:"px-2 py-1 text-sm text-white bg-yellow-500 rounded hover:bg-yellow-600"}," Unggah Ulang ",8,de)):y("",!0)])]))),128))]),G(te,{"preview-url":u.value,onClose:c[0]||(c[0]=m=>u.value="")},null,8,["preview-url"])]))}}),ie={class:"w-full"},pe={key:0,class:"flex flex-col gap-3 mb-4"},ce={class:"flex flex-col"},me=["disabled"],ve={class:"flex flex-col"},be=["disabled"],ge={class:"flex items-center gap-2 mb-3"},xe=["disabled"],fe={key:0},ke={key:1},ye={key:1,class:"text-sm text-yellow-700 ml-2"},_e={key:1,class:"text-red-500 text-sm mt-1"},he={key:2,class:"text-green-500 text-sm mt-1"},we={key:3,class:"fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center p-4 z-50"},Ee={class:"bg-white p-8 rounded-lg shadow-xl w-full max-w-md"},Se={class:"mb-4"},Te=["disabled"],$e={class:"flex justify-end space-x-3"},Ce=["disabled"],De=["disabled"],Ae={key:0},Re={key:1},Ne={key:0,class:"text-red-500 text-sm mt-3"},Pe={key:1,class:"text-green-500 text-sm mt-3"},Ie={__name:"SetDeedOnProgress",props:{deed:{type:Object,required:!0}},emits:["saved"],setup(T,{emit:h}){const x=T,a=h,u=g(null),i=g(""),f=g(!1),_=g(null),d=g(null),c=g(!1),m=g(""),k=g(!1),n=g(null),t=g(null),S=v=>{var D;if(!v||!v.deedType||!J[v.deedType])return!1;const o=J[v.deedType]||[],r=((D=x.deed)==null?void 0:D.deedDocs)||[];if(o.length===0)return!0;const w=r.filter(E=>E.status==="APPROVED").map(E=>E.docType);return o.every(E=>w.includes(E))},N=()=>{m.value="",n.value=null,t.value=null,c.value=!0},P=()=>{c.value=!1},I=async()=>{var v,o;n.value=null,t.value=null,k.value=!0;try{const r={status:"REJECTED",note:m.value||"Akta ditolak tanpa catatan spesifik."},w=await U.put(`/deeds/${x.deed.id}/status`,r,{withCredentials:!0});a("saved",w.data),t.value="Akta berhasil ditolak.",c.value=!1}catch(r){console.error("Error rejecting deed:",r),n.value="Terjadi error saat menolak akta: "+(((o=(v=r.response)==null?void 0:v.data)==null?void 0:o.message)||r.message||"Unknown error")}finally{k.value=!1}},j=async()=>{var v,o;if(_.value=null,d.value=null,f.value=!0,!u.value){_.value="Nomor akta tidak boleh kosong.",f.value=!1;return}try{const r={status:"IN_PROGRESS",note:i.value||"Dokumen telah diverifikasi dan akta sedang diproses.",number:u.value},w=await U.put(`/deeds/${x.deed.id}/status`,r,{withCredentials:!0});a("saved",w.data),d.value="Akta berhasil diproses dan status diatur IN_PROGRESS.",u.value=null,i.value=""}catch(r){console.error("Error processing deed:",r),_.value="Terjadi error saat memproses akta: "+(((o=(v=r.response)==null?void 0:v.data)==null?void 0:o.message)||r.message||"Unknown error")}finally{f.value=!1}};return(v,o)=>(s(),l("div",ie,[S(T.deed)?(s(),l("div",pe,[e("div",ce,[o[3]||(o[3]=e("label",{for:"deedNumber",class:"text-sm text-gray-600 mb-1"},"Nomor Akta:",-1)),A(e("input",{type:"number",id:"deedNumber","onUpdate:modelValue":o[0]||(o[0]=r=>u.value=r),placeholder:"Masukkan Nomor Akta",class:"border p-2 rounded w-full",disabled:f.value},null,8,me),[[R,u.value]])]),e("div",ve,[o[4]||(o[4]=e("label",{for:"processNote",class:"text-sm text-gray-600 mb-1"},"Catatan Proses (opsional):",-1)),A(e("textarea",{id:"processNote","onUpdate:modelValue":o[1]||(o[1]=r=>i.value=r),placeholder:"Catatan untuk proses (opsional)",class:"border p-2 rounded w-full",rows:"2",disabled:f.value},null,8,be),[[R,i.value]])])])):y("",!0),e("div",ge,[e("button",{onClick:N,class:"bg-red-600 text-white px-4 py-2 rounded shrink-0"}," Reject Akta "),S(T.deed)?(s(),l("button",{key:0,onClick:j,class:"bg-green-600 text-white px-4 py-2 rounded shrink-0",disabled:!u.value||f.value},[f.value?(s(),l("span",ke,"Memproses...")):(s(),l("span",fe,"Proses Akta"))],8,xe)):(s(),l("p",ye," Verifikasi semua dokumen untuk memproses akta. "))]),_.value?(s(),l("p",_e,p(_.value),1)):y("",!0),d.value?(s(),l("p",he,p(d.value),1)):y("",!0),c.value?(s(),l("div",we,[e("div",Ee,[o[6]||(o[6]=e("h3",{class:"text-xl font-bold mb-4 text-gray-800"},"Tolak Akta",-1)),e("div",Se,[o[5]||(o[5]=e("label",{for:"rejectNote",class:"block text-gray-700 text-sm font-bold mb-2"},"Catatan Penolakan (opsional):",-1)),A(e("textarea",{id:"rejectNote","onUpdate:modelValue":o[2]||(o[2]=r=>m.value=r),class:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",rows:"3",placeholder:"Cth: Dokumen KTP tidak jelas, mohon diunggah ulang.",disabled:k.value},null,8,Te),[[R,m.value]])]),e("div",$e,[e("button",{onClick:P,class:"bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold py-2 px-4 rounded-lg",disabled:k.value}," Batal ",8,Ce),e("button",{onClick:I,disabled:k.value,class:"bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-4 rounded-lg disabled:opacity-50"},[k.value?(s(),l("span",Re,"Menolak...")):(s(),l("span",Ae,"Tolak"))],8,De)]),n.value?(s(),l("p",Ne,p(n.value),1)):y("",!0),t.value?(s(),l("p",Pe,p(t.value),1)):y("",!0)])])):y("",!0)]))}},je=W(Ie,[["__scopeId","data-v-6743b295"]]),Oe={__name:"DeedComplete",props:{deed:{type:Object,required:!0}},emits:["open-invoice-form"],setup(T,{emit:h}){return(x,a)=>(s(),l("div",null,a[0]||(a[0]=[e("p",{class:"mb-4 text-base font-normal text-gray-700"},"Akta ini sudah selesai.",-1)])))}},Ue={class:"flex items-center gap-3 mb-4"},Ve={class:"flex gap-8 px-6 py-4 bg-white rounded-lg"},Ge={class:"w-2/3 border-gray-300 border-e-2"},Me={key:0,class:"mb-6"},Fe={class:"grid grid-cols-[auto_auto_1fr] gap-y-3 gap-x-2"},Be={class:"flex justify-start"},Le={class:"px-2 py-1 font-bold text-white bg-green-300 rounded"},Je={class:"px-4 pt-4 pb-2 mr-3 border border-gray-200 border-1"},qe={key:0},He={key:0},Ke={key:1},ze={class:"flex flex-wrap items-center gap-3 mb-4"},We={key:2},Ze={key:3},Xe={key:4},Qe={key:5},Ye={class:"w-1/3 pl-3"},et={class:"relative border-gray-200 border-s dark:border-gray-700"},tt={class:"mb-1 text-lg font-semibold text-gray-900 dark:text-white"},st={class:"block mb-2 text-sm font-bold leading-none text-gray-700 dark:text-gray-300"},at={class:"text-base font-normal text-gray-500 dark:text-gray-400"},nt={__name:"DeedDetail",setup(T){const h=Z(),x=Q(),a=g(null),u=g(""),i=["DRAFT","IN_PROGRESS","WAITING_SIGNATURE","COMPLETED","REJECTED"],f={DRAFT:"DRAFT",IN_PROGRESS:"SEDANG PROSES",WAITING_SIGNATURE:"MENUNGGU TANDA TANGAN",COMPLETED:"KOMPLET",REJECTED:"DITOLAK"},_=n=>f[n]||n,d=g([]),c=async n=>{a.value=n,d.value=(n==null?void 0:n.deedDocs)||[]},m=async()=>{var n;try{const t=await U.get(`/deeds/${x.params.id}/status-history`);a.value=t.data,d.value=((n=t.data)==null?void 0:n.deedDocs)||[]}catch(t){console.error("Error fetching deed detail:",t),alert("Gagal mengambil detail akta.")}},k=async n=>{try{const t={status:n,note:u.value},S=await U.put(`/deeds/${x.params.id}/status`,t,{withCredentials:!0});alert("Status berhasil diperbarui!"),a.value=S.data,u.value=""}catch(t){console.error("Error updating deed status:",t),alert("Gagal memperbarui status akta.")}};return X(m),(n,t)=>{var N,P,I,j,v,o,r,w,D,E,B,L;const S=Y("router-link");return s(),l("div",null,[e("div",Ue,[t[6]||(t[6]=e("h2",{class:"w-10/12 text-2xl font-semibold"},"Detail Akta",-1)),((N=a.value)==null?void 0:N.deedStatus)==="DRAFT"&&C(h).isUser?(s(),$(S,{key:0,to:{name:"EditAktaForm",params:{id:C(x).params.id}},class:"px-4 py-2 text-sm text-white bg-blue-400 rounded-md"},{default:q(()=>t[4]||(t[4]=[O(" Edit ")])),_:1,__:[4]},8,["to"])):y("",!0),C(h).isAdmin&&(((P=a.value)==null?void 0:P.deedStatus)===i[0]||((I=a.value)==null?void 0:I.deedStatus)===i[4])&&d.value.length>0?(s(),$(S,{key:1,to:`/operator/deeds/${C(x).params.id}/review-documents`,class:"px-4 py-2 text-sm text-white bg-green-500 rounded-md"},{default:q(()=>t[5]||(t[5]=[O(" Verifikasi Dokumen ")])),_:1,__:[5]},8,["to"])):y("",!0)]),e("div",Ve,[e("div",Ge,[a.value?(s(),l("div",Me,[e("div",Fe,[t[7]||(t[7]=e("p",{class:"font-semibold text-left"},"Nomor Akta",-1)),t[8]||(t[8]=e("p",null,":",-1)),e("p",null,p(a.value.number||"Belum ada nomor"),1),t[9]||(t[9]=e("p",{class:"font-semibold text-left"},"Judul",-1)),t[10]||(t[10]=e("p",null,":",-1)),e("p",null,p(a.value.title),1),t[11]||(t[11]=e("p",{class:"font-semibold text-left"},"Jenis",-1)),t[12]||(t[12]=e("p",null,":",-1)),e("p",null,p(a.value.deedType),1),t[13]||(t[13]=e("p",{class:"font-semibold text-left"},"Deskripsi",-1)),t[14]||(t[14]=e("p",null,":",-1)),e("p",null,p(a.value.description),1),t[15]||(t[15]=e("p",{class:"font-semibold text-left"},"Tanggal",-1)),t[16]||(t[16]=e("p",null,":",-1)),e("p",null,p(C(ee)(a.value.deedDate)),1),t[17]||(t[17]=e("p",{class:"font-semibold text-left"},"Status Saat Ini",-1)),t[18]||(t[18]=e("p",null,":",-1)),e("div",Be,[e("span",Le,p(_(a.value.deedStatus)),1)])])])):y("",!0),e("div",Je,[C(h).isAdmin?(s(),l("div",qe,[((j=a.value)==null?void 0:j.deedStatus)===i[0]&&d.value.length<1?(s(),l("div",He," Menunggu klien mengupload dokumen ")):(((v=a.value)==null?void 0:v.deedStatus)===i[0]||((o=a.value)==null?void 0:o.deedStatus)===i[4])&&d.value.length>0?(s(),l("div",Ke,[e("div",ze,[(s(!0),l(M,null,F(d.value,b=>(s(),l("button",{key:b.id,class:"flex items-center gap-2 px-4 py-2 border border-gray-400 rounded",disabled:""},[O(p(b.docType)+" ",1),b.status==="APPROVED"?(s(),$(V(n.CheckCircle),{key:0,class:"text-green-900"})):b.status==="REJECTED"?(s(),$(V(n.XCircle),{key:1,class:"text-red-800"})):(s(),$(V(n.FileText),{key:2}))]))),128))]),G(je,{deed:a.value,onSaved:c},null,8,["deed"])])):((r=a.value)==null?void 0:r.deedStatus)===i[1]?(s(),l("div",We,[t[19]||(t[19]=e("h4",{class:"mb-3 text-lg font-medium text-gray-900"}," Siap untuk Proses Tanda Tangan ",-1)),A(e("textarea",{"onUpdate:modelValue":t[0]||(t[0]=b=>u.value=b),placeholder:"Catatan perubahan status (opsional)",class:"w-full p-2 mb-3 border rounded"},null,512),[[R,u.value]]),e("button",{onClick:t[1]||(t[1]=b=>k("WAITING_SIGNATURE")),class:"px-4 py-2 text-white bg-green-600 rounded disabled:opacity-50 disabled:cursor-not-allowed"}," Proses Tanda Tangan ")])):((w=a.value)==null?void 0:w.deedStatus)===i[2]?(s(),l("div",Ze,[t[20]||(t[20]=e("h3",{class:"mb-3 text-lg font-medium text-gray-900"},"Selesaikan Proses Akta",-1)),A(e("textarea",{"onUpdate:modelValue":t[2]||(t[2]=b=>u.value=b),placeholder:"Catatan perubahan status (opsional)",class:"w-full p-2 mb-3 border rounded"},null,512),[[R,u.value]]),e("button",{onClick:t[3]||(t[3]=b=>k("COMPLETED")),class:"px-4 py-2 text-white bg-green-600 rounded"}," Selesaikan Akta ")])):((D=a.value)==null?void 0:D.deedStatus)===i[3]?(s(),l("div",Xe,[G(Oe,{deed:a.value,onOpenInvoiceForm:n.openInvoiceForm},null,8,["deed","onOpenInvoiceForm"])])):((E=a.value)==null?void 0:E.deedStatus)===i[4]?(s(),l("div",Qe," Akta ini DITOLAK. ")):y("",!0)])):(s(),$(ue,{key:1,documents:(B=a.value)==null?void 0:B.deedDocs},null,8,["documents"]))])]),e("div",Ye,[t[22]||(t[22]=e("h3",{class:"mb-2 text-xl font-medium"},"Riwayat Status",-1)),e("ol",et,[(s(!0),l(M,null,F((L=a.value)==null?void 0:L.statusHistories,(b,H)=>(s(),l("li",{key:H,class:"pb-4 ms-6"},[t[21]||(t[21]=e("span",{class:"absolute flex items-center justify-center w-6 h-6 bg-blue-100 rounded-full -start-3 ring-8 ring-white dark:ring-gray-900 dark:bg-blue-900"},[e("svg",{class:"w-2.5 h-2.5 text-blue-800 dark:text-blue-300","aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{d:"M20 4a2 2 0 0 0-2-2h-2V1a1 1 0 0 0-2 0v1h-3V1a1 1 0 0 0-2 0v1H6V1a1 1 0 0 0-2 0v1H2a2 2 0 0 0-2 2v2h20V4ZM0 18a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8H0v10Zm5-8h10a1 1 0 0 1 0 2H5a1 1 0 0 1 0-2Z"})])],-1)),e("h3",tt,p(_(b.status)),1),e("time",st,p(new Date(b.updatedAt).toLocaleString()),1),e("p",at,p(b.note),1)]))),128))])])])])}}};export{nt as default};

import{r as i,l as x,m as _,p as w,b as T,c as o,a,F as g,k as v,q as C,s as E,d as c,u as F,o as l,t as y,v as R}from"./index-DCE9A8Tx.js";const M={class:"max-w-3xl p-6 mx-auto space-y-4 bg-white shadow rounded-xl"},S={class:"mb-4"},U={class:"pl-5 text-sm text-gray-600 list-disc"},j={class:"mb-4"},q=["value"],B={class:"mb-4"},J={class:"flex justify-end gap-2 mt-6"},P=["disabled"],L={key:0},$={key:1},A={key:1,class:"mt-4 text-sm text-green-700"},V={__name:"DeedDocumentUpload",setup(G){const b=F(),d=i(),r=i([...d.deedDocs||[]]);x(()=>d,s=>{r.value=[...s.deedDocs||[]]},{immediate:!0});const m=_(()=>{if(!d||!d.deedType)return[];const s=w[d.deedType]||[],t=r.value.filter(e=>e.status!=="REJECTED").map(e=>e.docType);return s.filter(e=>!t.includes(e))}),u=i<File|null>null,n=i<string>"",p=i(!1),f=i([]),h=s=>{var e;const t=s.target;u.value=((e=t.files)==null?void 0:e[0])||null},D=async()=>{var t;const s=await c.get(`/deeds/${b.params.id}/status-history`);d.value=s.data,f.value=(t=s.data)==null?void 0:t.deedDocs},k=async()=>{if(!u.value||!n.value)return;p.value=!0;const s=new FormData;s.append("file",u.value),s.append("docType",n.value);const t=r.value.find(e=>e.docType===n.value&&e.status==="REJECTED");try{if(t)await c.put(`/deed-documents/${t.id}`,s,{headers:{"Content-Type":"multipart/form-data"}}),t.status="UPLOADED",t.name=u.value.name;else{const e=await c.post(`/deeds/${props.deed.id}/upload`,s,{headers:{"Content-Type":"multipart/form-data"}});r.value.push({id:e.data.id,docType:n.value,status:e.data.status||"UPLOADED",name:u.value.name})}alert("Dokumen berhasil diunggah."),props.onClose()}catch(e){console.error("Gagal unggah dokumen:",e),alert("Gagal mengunggah dokumen.")}finally{p.value=!1}};return T(D),(s,t)=>(l(),o("div",M,[a("div",S,[t[2]||(t[2]=a("p",{class:"mb-1 font-medium text-gray-700"},"Dokumen Wajib:",-1)),a("ul",U,[(l(!0),o(g,null,v(m.value,e=>(l(),o("li",{key:e},y(e),1))),128))])]),m.value.length>0?(l(),o("form",{key:0,onSubmit:C(k,["prevent"])},[a("div",j,[t[4]||(t[4]=a("label",{class:"block text-sm font-medium text-gray-700"},"Jenis Dokumen",-1)),E(a("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>n=e),class:"block w-full p-2 mt-1 border rounded"},[t[3]||(t[3]=a("option",{disabled:"",value:""},"-- Pilih Jenis Dokumen --",-1)),(l(!0),o(g,null,v(m.value,e=>(l(),o("option",{key:e,value:e},y(e),9,q))),128))],512),[[R,n]])]),a("div",B,[t[5]||(t[5]=a("label",{class:"block text-sm font-medium text-gray-700"},"Pilih File",-1)),a("input",{type:"file",onChange:h,class:"block w-full p-2 mt-1 border rounded"},null,32)]),a("div",J,[a("button",{type:"button",onClick:t[1]||(t[1]=(...e)=>s.onClose&&s.onClose(...e)),class:"px-4 py-2 text-gray-700 bg-gray-200 rounded hover:bg-gray-300"}," Batal "),a("button",{type:"submit",class:"px-4 py-2 text-white bg-blue-600 rounded hover:bg-blue-700",disabled:!u||!n||p.value},[p.value?(l(),o("span",L,"Mengunggah...")):(l(),o("span",$,"Unggah"))],8,P)])],32)):(l(),o("p",A," Semua dokumen wajib telah diunggah. "))]))}};export{V as default};

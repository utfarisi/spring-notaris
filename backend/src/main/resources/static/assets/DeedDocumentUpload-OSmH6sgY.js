import{l as x,r as i,m as _,p as w,q as T,b as C,c as o,a as s,F as g,k as v,s as E,v as F,x as R,d as c,u as M,o as l,t as y}from"./index-BK-ndIw0.js";const S={class:"max-w-3xl mx-auto bg-white rounded-xl shadow p-6 space-y-4"},U={class:"mb-4"},j={class:"list-disc pl-5 text-sm text-gray-600"},q={class:"mb-4"},B=["value"],J={class:"mb-4"},P={class:"flex justify-end gap-2 mt-6"},L=["disabled"],$={key:0},A={key:1},G={key:1,class:"text-sm text-green-700 mt-4"},N=x({__name:"DeedDocumentUpload",setup(O){const b=M(),d=i(),r=i([...d.deedDocs||[]]);_(()=>d,a=>{r.value=[...a.deedDocs||[]]},{immediate:!0});const m=w(()=>{if(!d||!d.deedType)return[];const a=T[d.deedType]||[],t=r.value.filter(e=>e.status!=="REJECTED").map(e=>e.docType);return a.filter(e=>!t.includes(e))}),u=i(null),n=i(""),p=i(!1),f=i([]),h=a=>{var e;const t=a.target;u.value=((e=t.files)==null?void 0:e[0])||null},D=async()=>{var t;const a=await c.get(`/deeds/${b.params.id}/status-history`);d.value=a.data,f.value=(t=a.data)==null?void 0:t.deedDocs},k=async()=>{if(!u.value||!n.value)return;p.value=!0;const a=new FormData;a.append("file",u.value),a.append("docType",n.value);const t=r.value.find(e=>e.docType===n.value&&e.status==="REJECTED");try{if(t)await c.put(`/deed-documents/${t.id}`,a,{headers:{"Content-Type":"multipart/form-data"}}),t.status="UPLOADED",t.name=u.value.name;else{const e=await c.post(`/deeds/${props.deed.id}/upload`,a,{headers:{"Content-Type":"multipart/form-data"}});r.value.push({id:e.data.id,docType:n.value,status:e.data.status||"UPLOADED",name:u.value.name})}alert("Dokumen berhasil diunggah."),props.onClose()}catch(e){console.error("Gagal unggah dokumen:",e),alert("Gagal mengunggah dokumen.")}finally{p.value=!1}};return C(D),(a,t)=>(l(),o("div",S,[s("div",U,[t[2]||(t[2]=s("p",{class:"font-medium text-gray-700 mb-1"},"Dokumen Wajib:",-1)),s("ul",j,[(l(!0),o(g,null,v(m.value,e=>(l(),o("li",{key:e},y(e),1))),128))])]),m.value.length>0?(l(),o("form",{key:0,onSubmit:E(k,["prevent"])},[s("div",q,[t[4]||(t[4]=s("label",{class:"block text-sm font-medium text-gray-700"},"Jenis Dokumen",-1)),F(s("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>n.value=e),class:"mt-1 block w-full border p-2 rounded"},[t[3]||(t[3]=s("option",{disabled:"",value:""},"-- Pilih Jenis Dokumen --",-1)),(l(!0),o(g,null,v(m.value,e=>(l(),o("option",{key:e,value:e},y(e),9,B))),128))],512),[[R,n.value]])]),s("div",J,[t[5]||(t[5]=s("label",{class:"block text-sm font-medium text-gray-700"},"Pilih File",-1)),s("input",{type:"file",onChange:h,class:"mt-1 block w-full border p-2 rounded"},null,32)]),s("div",P,[s("button",{type:"button",onClick:t[1]||(t[1]=(...e)=>a.onClose&&a.onClose(...e)),class:"px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded"}," Batal "),s("button",{type:"submit",class:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded",disabled:!u.value||!n.value||p.value},[p.value?(l(),o("span",$,"Mengunggah...")):(l(),o("span",A,"Unggah"))],8,L)])],32)):(l(),o("p",G," Semua dokumen wajib telah diunggah. "))]))}});export{N as default};

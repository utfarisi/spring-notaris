import{r as v,c as l,o as s,a as e,i as G,F as M,l as F,t as p,k as O,n as K,e as y,_ as z,v as C,y as R,q as J,d as U,z as W,b as Z,A as $,f as D,w as q,u as X,j as Q,B as Y,C as V}from"./index-CdUnIpcg.js";import{_ as ee}from"./PreviewDocument.vue_vue_type_script_setup_true_lang-CuvSn-1D.js";const te={class:"p-2"},se={class:"flex flex-wrap gap-3"},ae={class:"font-semibold"},le={class:"text-sm"},oe={class:"flex gap-2"},ne=["onClick"],de=["onClick"],re={__name:"DeedUserDocument",props:{documents:{id,docType,name,status,filePath}},emits:["reupload"],setup(S,{emit:h}){const x=v("http://localhost:8080"),a=h,r=v(""),i=u=>{a("reupload",u)},f=u=>{const c=`${x}/${u.name}`;r.value=c,console.log(" previewUrl ",r.value)},_=u=>{switch(u){case"APPROVED":return"text-green-600 font-semibold";case"REJECTED":return"text-red-600 font-semibold";case"PENDING":return"text-yellow-600 font-semibold";default:return"text-gray-600"}};return(u,c)=>(s(),l("div",te,[c[2]||(c[2]=e("h3",{class:"mb-4 text-lg font-bold"},"Daftar Dokumen",-1)),e("div",se,[(s(!0),l(M,null,F(S.documents,m=>(s(),l("div",{key:m.id,class:"flex-grow w-full p-2 border border-gray-400 sm:w-auto rounded-2xl"},[e("div",null,[e("p",ae,p(m.docType),1),e("p",le,[c[1]||(c[1]=O(" Status: ")),e("span",{class:K(_(m.status))},p(m.status),3)])]),e("div",oe,[e("button",{onClick:k=>f(m),class:"text-blue-600 underline"},"Lihat",8,ne),m.status==="REJECTED"?(s(),l("button",{key:0,onClick:k=>i(m),class:"px-2 py-1 text-sm text-white bg-yellow-500 rounded hover:bg-yellow-600"}," Unggah Ulang ",8,de)):y("",!0)])]))),128))]),G(ee,{"preview-url":r.value,onClose:c[0]||(c[0]=m=>r.value="")},null,8,["preview-url"])]))}},ue={class:"w-full"},ie={key:0,class:"flex flex-col gap-3 mb-4"},pe={class:"flex flex-col"},ce=["disabled"],me={class:"flex flex-col"},ve=["disabled"],be={class:"flex items-center gap-2 mb-3"},ge=["disabled"],xe={key:0},fe={key:1},ke={key:1,class:"text-sm text-yellow-700 ml-2"},ye={key:1,class:"text-red-500 text-sm mt-1"},_e={key:2,class:"text-green-500 text-sm mt-1"},he={key:3,class:"fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center p-4 z-50"},we={class:"bg-white p-8 rounded-lg shadow-xl w-full max-w-md"},Ee={class:"mb-4"},Se=["disabled"],Te={class:"flex justify-end space-x-3"},$e=["disabled"],De=["disabled"],Ae={key:0},Ce={key:1},Re={key:0,class:"text-red-500 text-sm mt-3"},Ne={key:1,class:"text-green-500 text-sm mt-3"},Pe={__name:"SetDeedOnProgress",props:{deed:{type:Object,required:!0}},emits:["saved"],setup(S,{emit:h}){const x=S,a=h,r=v(null),i=v(""),f=v(!1),_=v(null),u=v(null),c=v(!1),m=v(""),k=v(!1),n=v(null),t=v(null),T=b=>{var A;if(!b||!b.deedType||!J[b.deedType])return!1;const o=J[b.deedType]||[],d=((A=x.deed)==null?void 0:A.deedDocs)||[];if(o.length===0)return!0;const w=d.filter(E=>E.status==="APPROVED").map(E=>E.docType);return o.every(E=>w.includes(E))},N=()=>{m.value="",n.value=null,t.value=null,c.value=!0},P=()=>{c.value=!1},I=async()=>{var b,o;n.value=null,t.value=null,k.value=!0;try{const d={status:"REJECTED",note:m.value||"Akta ditolak tanpa catatan spesifik."},w=await U.put(`/deeds/${x.deed.id}/status`,d,{withCredentials:!0});a("saved",w.data),t.value="Akta berhasil ditolak.",c.value=!1}catch(d){console.error("Error rejecting deed:",d),n.value="Terjadi error saat menolak akta: "+(((o=(b=d.response)==null?void 0:b.data)==null?void 0:o.message)||d.message||"Unknown error")}finally{k.value=!1}},j=async()=>{var b,o;if(_.value=null,u.value=null,f.value=!0,!r.value){_.value="Nomor akta tidak boleh kosong.",f.value=!1;return}try{const d={status:"IN_PROGRESS",note:i.value||"Dokumen telah diverifikasi dan akta sedang diproses.",number:r.value},w=await U.put(`/deeds/${x.deed.id}/status`,d,{withCredentials:!0});a("saved",w.data),u.value="Akta berhasil diproses dan status diatur IN_PROGRESS.",r.value=null,i.value=""}catch(d){console.error("Error processing deed:",d),_.value="Terjadi error saat memproses akta: "+(((o=(b=d.response)==null?void 0:b.data)==null?void 0:o.message)||d.message||"Unknown error")}finally{f.value=!1}};return(b,o)=>(s(),l("div",ue,[T(S.deed)?(s(),l("div",ie,[e("div",pe,[o[3]||(o[3]=e("label",{for:"deedNumber",class:"text-sm text-gray-600 mb-1"},"Nomor Akta:",-1)),C(e("input",{type:"number",id:"deedNumber","onUpdate:modelValue":o[0]||(o[0]=d=>r.value=d),placeholder:"Masukkan Nomor Akta",class:"border p-2 rounded w-full",disabled:f.value},null,8,ce),[[R,r.value]])]),e("div",me,[o[4]||(o[4]=e("label",{for:"processNote",class:"text-sm text-gray-600 mb-1"},"Catatan Proses (opsional):",-1)),C(e("textarea",{id:"processNote","onUpdate:modelValue":o[1]||(o[1]=d=>i.value=d),placeholder:"Catatan untuk proses (opsional)",class:"border p-2 rounded w-full",rows:"2",disabled:f.value},null,8,ve),[[R,i.value]])])])):y("",!0),e("div",be,[e("button",{onClick:N,class:"bg-red-600 text-white px-4 py-2 rounded shrink-0"}," Reject Akta "),T(S.deed)?(s(),l("button",{key:0,onClick:j,class:"bg-green-600 text-white px-4 py-2 rounded shrink-0",disabled:!r.value||f.value},[f.value?(s(),l("span",fe,"Memproses...")):(s(),l("span",xe,"Proses Akta"))],8,ge)):(s(),l("p",ke," Verifikasi semua dokumen untuk memproses akta. "))]),_.value?(s(),l("p",ye,p(_.value),1)):y("",!0),u.value?(s(),l("p",_e,p(u.value),1)):y("",!0),c.value?(s(),l("div",he,[e("div",we,[o[6]||(o[6]=e("h3",{class:"text-xl font-bold mb-4 text-gray-800"},"Tolak Akta",-1)),e("div",Ee,[o[5]||(o[5]=e("label",{for:"rejectNote",class:"block text-gray-700 text-sm font-bold mb-2"},"Catatan Penolakan (opsional):",-1)),C(e("textarea",{id:"rejectNote","onUpdate:modelValue":o[2]||(o[2]=d=>m.value=d),class:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",rows:"3",placeholder:"Cth: Dokumen KTP tidak jelas, mohon diunggah ulang.",disabled:k.value},null,8,Se),[[R,m.value]])]),e("div",Te,[e("button",{onClick:P,class:"bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold py-2 px-4 rounded-lg",disabled:k.value}," Batal ",8,$e),e("button",{onClick:I,disabled:k.value,class:"bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-4 rounded-lg disabled:opacity-50"},[k.value?(s(),l("span",Ce,"Menolak...")):(s(),l("span",Ae,"Tolak"))],8,De)]),n.value?(s(),l("p",Re,p(n.value),1)):y("",!0),t.value?(s(),l("p",Ne,p(t.value),1)):y("",!0)])])):y("",!0)]))}},Ie=z(Pe,[["__scopeId","data-v-6743b295"]]),je={__name:"DeedComplete",props:{deed:{type:Object,required:!0}},emits:["open-invoice-form"],setup(S,{emit:h}){return(x,a)=>(s(),l("div",null,a[0]||(a[0]=[e("p",{class:"mb-4 text-base font-normal text-gray-700"},"Akta ini sudah selesai.",-1)])))}},Oe={class:"flex items-center gap-3 mb-4"},Ue={class:"flex gap-8 px-6 py-4 bg-white rounded-lg"},Ve={class:"w-2/3 border-gray-300 border-e-2"},Ge={key:0,class:"mb-6"},Me={class:"grid grid-cols-[auto_auto_1fr] gap-y-3 gap-x-2"},Fe={class:"flex justify-start"},Be={class:"px-2 py-1 font-bold text-white bg-green-300 rounded"},Le={class:"px-4 pt-4 pb-2 mr-3 border border-gray-200 border-1"},Je={key:0},qe={key:0},He={key:1},Ke={class:"flex flex-wrap items-center gap-3 mb-4"},ze={key:2},We={key:3},Ze={key:4},Xe={key:5},Qe={class:"w-1/3 pl-3"},Ye={class:"relative border-gray-200 border-s dark:border-gray-700"},et={class:"mb-1 text-lg font-semibold text-gray-900 dark:text-white"},tt={class:"block mb-2 text-sm font-bold leading-none text-gray-700 dark:text-gray-300"},st={class:"text-base font-normal text-gray-500 dark:text-gray-400"},ot={__name:"DeedDetail",setup(S){const h=W(),x=X(),a=v(null),r=v(""),i=["DRAFT","IN_PROGRESS","WAITING_SIGNATURE","COMPLETED","REJECTED"],f={DRAFT:"DRAFT",IN_PROGRESS:"SEDANG PROSES",WAITING_SIGNATURE:"MENUNGGU TANDA TANGAN",COMPLETED:"KOMPLET",REJECTED:"DITOLAK"},_=n=>f[n]||n,u=v([]),c=async n=>{a.value=n,u.value=(n==null?void 0:n.deedDocs)||[]},m=async()=>{var n;try{const t=await U.get(`/deeds/${x.params.id}/status-history`);a.value=t.data,u.value=((n=t.data)==null?void 0:n.deedDocs)||[]}catch(t){console.error("Error fetching deed detail:",t),alert("Gagal mengambil detail akta.")}},k=async n=>{try{const t={status:n,note:r.value},T=await U.put(`/deeds/${x.params.id}/status`,t,{withCredentials:!0});alert("Status berhasil diperbarui!"),a.value=T.data,r.value=""}catch(t){console.error("Error updating deed status:",t),alert("Gagal memperbarui status akta.")}};return Z(m),(n,t)=>{var N,P,I,j,b,o,d,w,A,E,B,L;const T=Q("router-link");return s(),l("div",null,[e("div",Oe,[t[6]||(t[6]=e("h2",{class:"w-10/12 text-2xl font-semibold"},"Detail Akta",-1)),((N=a.value)==null?void 0:N.deedStatus)==="DRAFT"&&D(h).isUser?(s(),$(T,{key:0,to:{name:"EditAktaForm",params:{id:D(x).params.id}},class:"px-4 py-2 text-sm text-white bg-blue-400 rounded-md"},{default:q(()=>t[4]||(t[4]=[O(" Edit ")])),_:1,__:[4]},8,["to"])):y("",!0),D(h).isAdmin&&(((P=a.value)==null?void 0:P.deedStatus)===i[0]||((I=a.value)==null?void 0:I.deedStatus)===i[4])&&u.value.length>0?(s(),$(T,{key:1,to:`/operator/deeds/${D(x).params.id}/review-documents`,class:"px-4 py-2 text-sm text-white bg-green-500 rounded-md"},{default:q(()=>t[5]||(t[5]=[O(" Verifikasi Dokumen ")])),_:1,__:[5]},8,["to"])):y("",!0)]),e("div",Ue,[e("div",Ve,[a.value?(s(),l("div",Ge,[e("div",Me,[t[7]||(t[7]=e("p",{class:"font-semibold text-left"},"Nomor Akta",-1)),t[8]||(t[8]=e("p",null,":",-1)),e("p",null,p(a.value.number||"Belum ada nomor"),1),t[9]||(t[9]=e("p",{class:"font-semibold text-left"},"Judul",-1)),t[10]||(t[10]=e("p",null,":",-1)),e("p",null,p(a.value.title),1),t[11]||(t[11]=e("p",{class:"font-semibold text-left"},"Jenis",-1)),t[12]||(t[12]=e("p",null,":",-1)),e("p",null,p(a.value.deedType),1),t[13]||(t[13]=e("p",{class:"font-semibold text-left"},"Deskripsi",-1)),t[14]||(t[14]=e("p",null,":",-1)),e("p",null,p(a.value.description),1),t[15]||(t[15]=e("p",{class:"font-semibold text-left"},"Tanggal",-1)),t[16]||(t[16]=e("p",null,":",-1)),e("p",null,p(D(Y)(a.value.deedDate)),1),t[17]||(t[17]=e("p",{class:"font-semibold text-left"},"Status Saat Ini",-1)),t[18]||(t[18]=e("p",null,":",-1)),e("div",Fe,[e("span",Be,p(_(a.value.deedStatus)),1)])])])):y("",!0),e("div",Le,[D(h).isAdmin?(s(),l("div",Je,[((j=a.value)==null?void 0:j.deedStatus)===i[0]&&u.value.length<1?(s(),l("div",qe," Menunggu klien mengupload dokumen ")):(((b=a.value)==null?void 0:b.deedStatus)===i[0]||((o=a.value)==null?void 0:o.deedStatus)===i[4])&&u.value.length>0?(s(),l("div",He,[e("div",Ke,[(s(!0),l(M,null,F(u.value,g=>(s(),l("button",{key:g.id,class:"flex items-center gap-2 px-4 py-2 border border-gray-400 rounded",disabled:""},[O(p(g.docType)+" ",1),g.status==="APPROVED"?(s(),$(V(n.CheckCircle),{key:0,class:"text-green-900"})):g.status==="REJECTED"?(s(),$(V(n.XCircle),{key:1,class:"text-red-800"})):(s(),$(V(n.FileText),{key:2}))]))),128))]),G(Ie,{deed:a.value,onSaved:c},null,8,["deed"])])):((d=a.value)==null?void 0:d.deedStatus)===i[1]?(s(),l("div",ze,[t[19]||(t[19]=e("h4",{class:"mb-3 text-lg font-medium text-gray-900"}," Siap untuk Proses Tanda Tangan ",-1)),C(e("textarea",{"onUpdate:modelValue":t[0]||(t[0]=g=>r.value=g),placeholder:"Catatan perubahan status (opsional)",class:"w-full p-2 mb-3 border rounded"},null,512),[[R,r.value]]),e("button",{onClick:t[1]||(t[1]=g=>k("WAITING_SIGNATURE")),class:"px-4 py-2 text-white bg-green-600 rounded disabled:opacity-50 disabled:cursor-not-allowed"}," Proses Tanda Tangan ")])):((w=a.value)==null?void 0:w.deedStatus)===i[2]?(s(),l("div",We,[t[20]||(t[20]=e("h3",{class:"mb-3 text-lg font-medium text-gray-900"},"Selesaikan Proses Akta",-1)),C(e("textarea",{"onUpdate:modelValue":t[2]||(t[2]=g=>r.value=g),placeholder:"Catatan perubahan status (opsional)",class:"w-full p-2 mb-3 border rounded"},null,512),[[R,r.value]]),e("button",{onClick:t[3]||(t[3]=g=>k("COMPLETED")),class:"px-4 py-2 text-white bg-green-600 rounded"}," Selesaikan Akta ")])):((A=a.value)==null?void 0:A.deedStatus)===i[3]?(s(),l("div",Ze,[G(je,{deed:a.value,onOpenInvoiceForm:n.openInvoiceForm},null,8,["deed","onOpenInvoiceForm"])])):((E=a.value)==null?void 0:E.deedStatus)===i[4]?(s(),l("div",Xe," Akta ini DITOLAK. ")):y("",!0)])):(s(),$(re,{key:1,documents:(B=a.value)==null?void 0:B.deedDocs},null,8,["documents"]))])]),e("div",Qe,[t[22]||(t[22]=e("h3",{class:"mb-2 text-xl font-medium"},"Riwayat Status",-1)),e("ol",Ye,[(s(!0),l(M,null,F((L=a.value)==null?void 0:L.statusHistories,(g,H)=>(s(),l("li",{key:H,class:"pb-4 ms-6"},[t[21]||(t[21]=e("span",{class:"absolute flex items-center justify-center w-6 h-6 bg-blue-100 rounded-full -start-3 ring-8 ring-white dark:ring-gray-900 dark:bg-blue-900"},[e("svg",{class:"w-2.5 h-2.5 text-blue-800 dark:text-blue-300","aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{d:"M20 4a2 2 0 0 0-2-2h-2V1a1 1 0 0 0-2 0v1h-3V1a1 1 0 0 0-2 0v1H6V1a1 1 0 0 0-2 0v1H2a2 2 0 0 0-2 2v2h20V4ZM0 18a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8H0v10Zm5-8h10a1 1 0 0 1 0 2H5a1 1 0 0 1 0-2Z"})])],-1)),e("h3",et,p(_(g.status)),1),e("time",tt,p(new Date(g.updatedAt).toLocaleString()),1),e("p",st,p(g.note),1)]))),128))])])])])}}};export{ot as default};

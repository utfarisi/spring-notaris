import{h as K,r as g,c as a,a as e,i as H,F as O,l as M,t as p,k as U,n as z,e as y,o as s,_ as W,v as D,y as R,q as F,d as V,z as Z,b as X,A as T,f as C,w as J,u as Q,j as Y,B as G}from"./index-DITnirLC.js";import{_ as ee}from"./PreviewDocument.vue_vue_type_script_setup_true_lang-CHxH9seS.js";const te={class:"p-2"},se={class:"flex flex-wrap gap-3"},ae={class:"font-semibold"},le={class:"text-sm"},oe={class:"flex gap-2"},ne=["onClick"],de=["onClick"],re=K({__name:"DeedUserDocument",props:{documents:{}},emits:["reupload"],setup($,{emit:E}){const f="https://spring-notaris-production.up.railway.app",l=E,u=g(""),i=r=>{l("reupload",r)},x=r=>{const c=`${f}/${r.name}`;u.value=c,console.log(" previewUrl ",u.value)},_=r=>{switch(r){case"APPROVED":return"text-green-600 font-semibold";case"REJECTED":return"text-red-600 font-semibold";case"PENDING":return"text-yellow-600 font-semibold";default:return"text-gray-600"}};return(r,c)=>(s(),a("div",te,[c[2]||(c[2]=e("h3",{class:"text-lg font-bold mb-4"},"Daftar Dokumen",-1)),e("div",se,[(s(!0),a(O,null,M(r.documents,m=>(s(),a("div",{key:m.id,class:"w-full sm:w-auto flex-grow border border-gray-400 p-2 rounded-2xl"},[e("div",null,[e("p",ae,p(m.docType),1),e("p",le,[c[1]||(c[1]=U(" Status: ")),e("span",{class:z(_(m.status))},p(m.status),3)])]),e("div",oe,[e("button",{onClick:k=>x(m),class:"text-blue-600 underline"},"Lihat",8,ne),m.status==="REJECTED"?(s(),a("button",{key:0,onClick:k=>i(m),class:"bg-yellow-500 text-white text-sm px-2 py-1 rounded hover:bg-yellow-600"}," Unggah Ulang ",8,de)):y("",!0)])]))),128))]),H(ee,{"preview-url":u.value,onClose:c[0]||(c[0]=m=>u.value="")},null,8,["preview-url"])]))}}),ue={class:"w-full"},ie={key:0,class:"flex flex-col gap-3 mb-4"},pe={class:"flex flex-col"},ce=["disabled"],me={class:"flex flex-col"},ve=["disabled"],be={class:"flex items-center gap-2 mb-3"},ge=["disabled"],xe={key:0},ke={key:1},ye={key:1,class:"text-sm text-yellow-700 ml-2"},fe={key:1,class:"text-red-500 text-sm mt-1"},_e={key:2,class:"text-green-500 text-sm mt-1"},he={key:3,class:"fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center p-4 z-50"},we={class:"bg-white p-8 rounded-lg shadow-xl w-full max-w-md"},Ee={class:"mb-4"},Se=["disabled"],Te={class:"flex justify-end space-x-3"},$e=["disabled"],Ae=["disabled"],Ce={key:0},De={key:1},Re={key:0,class:"text-red-500 text-sm mt-3"},Ne={key:1,class:"text-green-500 text-sm mt-3"},Pe={__name:"SetDeedOnProgress",props:{deed:{type:Object,required:!0}},emits:["saved"],setup($,{emit:E}){const f=$,l=E,u=g(null),i=g(""),x=g(!1),_=g(null),r=g(null),c=g(!1),m=g(""),k=g(!1),n=g(null),t=g(null),S=v=>{var A;if(!v||!v.deedType||!F[v.deedType])return!1;const o=F[v.deedType]||[],d=((A=f.deed)==null?void 0:A.deedDocs)||[];if(o.length===0)return!0;const h=d.filter(w=>w.status==="APPROVED").map(w=>w.docType);return o.every(w=>h.includes(w))},N=()=>{m.value="",n.value=null,t.value=null,c.value=!0},P=()=>{c.value=!1},I=async()=>{var v,o;n.value=null,t.value=null,k.value=!0;try{const d={status:"REJECTED",note:m.value||"Akta ditolak tanpa catatan spesifik."},h=await V.put(`/deeds/${f.deed.id}/status`,d,{withCredentials:!0});l("saved",h.data),t.value="Akta berhasil ditolak.",c.value=!1}catch(d){console.error("Error rejecting deed:",d),n.value="Terjadi error saat menolak akta: "+(((o=(v=d.response)==null?void 0:v.data)==null?void 0:o.message)||d.message||"Unknown error")}finally{k.value=!1}},j=async()=>{var v,o;if(_.value=null,r.value=null,x.value=!0,!u.value){_.value="Nomor akta tidak boleh kosong.",x.value=!1;return}try{const d={status:"IN_PROGRESS",note:i.value||"Dokumen telah diverifikasi dan akta sedang diproses.",number:u.value},h=await V.put(`/deeds/${f.deed.id}/status`,d,{withCredentials:!0});l("saved",h.data),r.value="Akta berhasil diproses dan status diatur IN_PROGRESS.",u.value=null,i.value=""}catch(d){console.error("Error processing deed:",d),_.value="Terjadi error saat memproses akta: "+(((o=(v=d.response)==null?void 0:v.data)==null?void 0:o.message)||d.message||"Unknown error")}finally{x.value=!1}};return(v,o)=>(s(),a("div",ue,[S($.deed)?(s(),a("div",ie,[e("div",pe,[o[3]||(o[3]=e("label",{for:"deedNumber",class:"text-sm text-gray-600 mb-1"},"Nomor Akta:",-1)),D(e("input",{type:"number",id:"deedNumber","onUpdate:modelValue":o[0]||(o[0]=d=>u.value=d),placeholder:"Masukkan Nomor Akta",class:"border p-2 rounded w-full",disabled:x.value},null,8,ce),[[R,u.value]])]),e("div",me,[o[4]||(o[4]=e("label",{for:"processNote",class:"text-sm text-gray-600 mb-1"},"Catatan Proses (opsional):",-1)),D(e("textarea",{id:"processNote","onUpdate:modelValue":o[1]||(o[1]=d=>i.value=d),placeholder:"Catatan untuk proses (opsional)",class:"border p-2 rounded w-full",rows:"2",disabled:x.value},null,8,ve),[[R,i.value]])])])):y("",!0),e("div",be,[e("button",{onClick:N,class:"bg-red-600 text-white px-4 py-2 rounded shrink-0"}," Reject Akta "),S($.deed)?(s(),a("button",{key:0,onClick:j,class:"bg-green-600 text-white px-4 py-2 rounded shrink-0",disabled:!u.value||x.value},[x.value?(s(),a("span",ke,"Memproses...")):(s(),a("span",xe,"Proses Akta"))],8,ge)):(s(),a("p",ye," Verifikasi semua dokumen untuk memproses akta. "))]),_.value?(s(),a("p",fe,p(_.value),1)):y("",!0),r.value?(s(),a("p",_e,p(r.value),1)):y("",!0),c.value?(s(),a("div",he,[e("div",we,[o[6]||(o[6]=e("h3",{class:"text-xl font-bold mb-4 text-gray-800"},"Tolak Akta",-1)),e("div",Ee,[o[5]||(o[5]=e("label",{for:"rejectNote",class:"block text-gray-700 text-sm font-bold mb-2"},"Catatan Penolakan (opsional):",-1)),D(e("textarea",{id:"rejectNote","onUpdate:modelValue":o[2]||(o[2]=d=>m.value=d),class:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",rows:"3",placeholder:"Cth: Dokumen KTP tidak jelas, mohon diunggah ulang.",disabled:k.value},null,8,Se),[[R,m.value]])]),e("div",Te,[e("button",{onClick:P,class:"bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold py-2 px-4 rounded-lg",disabled:k.value}," Batal ",8,$e),e("button",{onClick:I,disabled:k.value,class:"bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-4 rounded-lg disabled:opacity-50"},[k.value?(s(),a("span",De,"Menolak...")):(s(),a("span",Ce,"Tolak"))],8,Ae)]),n.value?(s(),a("p",Re,p(n.value),1)):y("",!0),t.value?(s(),a("p",Ne,p(t.value),1)):y("",!0)])])):y("",!0)]))}},Ie=W(Pe,[["__scopeId","data-v-6743b295"]]),je={class:"flex gap-3 items-center mb-4"},Ue={class:"gap-8 flex bg-white px-6 py-4 rounded-lg"},Ve={class:"w-2/3 border-e-2 border-gray-300"},Ge={key:0,class:"mb-6"},Oe={class:"grid grid-cols-[auto_auto_1fr] gap-y-3 gap-x-2"},Me={class:"px-2 py-1 bg-green-800 rounded-md max-w-sm text-white font-bold text-xs"},Be={class:"px-4 pt-4 pb-2 border border-1 border-gray-200 mr-3"},Le={key:0},Fe={key:0},Je={key:1},He={class:"flex flex-wrap items-center gap-3 mb-4"},qe={key:2},Ke={key:3},ze={key:4},We={key:5},Ze={class:"pl-3 w-1/3"},Xe={class:"relative border-s border-gray-200 dark:border-gray-700"},Qe={class:"mb-1 text-lg font-semibold text-gray-900 dark:text-white"},Ye={class:"block mb-2 text-sm font-bold leading-none text-gray-700 dark:text-gray-300"},et={class:"text-base font-normal text-gray-500 dark:text-gray-400"},at={__name:"DeedDetail",setup($){const E=Z(),f=Q(),l=g(null),u=g(""),i=["DRAFT","IN_PROGRESS","WAITING_SIGNATURE","COMPLETED","REJECTED"],x={DRAFT:"DRAFT",IN_PROGRESS:"SEDANG PROSES",WAITING_SIGNATURE:"MENUNGGU TANDA TANGAN",COMPLETED:"KOMPLIT",REJECTED:"DITOLAK"},_=n=>x[n]||n,r=g([]),c=async n=>{l.value=n,r.value=(n==null?void 0:n.deedDocs)||[]},m=async()=>{var n;try{const t=await V.get(`/deeds/${f.params.id}/status-history`);l.value=t.data,r.value=((n=t.data)==null?void 0:n.deedDocs)||[]}catch(t){console.error("Error fetching deed detail:",t),alert("Gagal mengambil detail akta.")}},k=async n=>{try{const t={status:n,note:u.value},S=await V.put(`/deeds/${f.params.id}/status`,t,{withCredentials:!0});alert("Status berhasil diperbarui!"),l.value=S.data,u.value=""}catch(t){console.error("Error updating deed status:",t),alert("Gagal memperbarui status akta.")}};return X(m),(n,t)=>{var N,P,I,j,v,o,d,h,A,w,B,L;const S=Y("router-link");return s(),a("div",null,[e("div",je,[t[6]||(t[6]=e("h2",{class:"text-2xl font-semibold w-10/12"},"Detail Akta",-1)),((N=l.value)==null?void 0:N.deedStatus)==="DRAFT"&&C(E).isUser?(s(),T(S,{key:0,to:{name:"EditAktaForm",params:{id:C(f).params.id}},class:"bg-blue-400 px-4 py-2 rounded-md text-white text-sm"},{default:J(()=>t[4]||(t[4]=[U(" Edit ")])),_:1,__:[4]},8,["to"])):y("",!0),C(E).isAdmin&&(((P=l.value)==null?void 0:P.deedStatus)===i[0]||((I=l.value)==null?void 0:I.deedStatus)===i[4])&&r.value.length>0?(s(),T(S,{key:1,to:`/operator/deeds/${C(f).params.id}/review-documents`,class:"bg-green-500 px-4 py-2 rounded-md text-white text-sm"},{default:J(()=>t[5]||(t[5]=[U(" Verifikasi Dokumen ")])),_:1,__:[5]},8,["to"])):y("",!0)]),e("div",Ue,[e("div",Ve,[l.value?(s(),a("div",Ge,[e("div",Oe,[t[7]||(t[7]=e("p",{class:"font-semibold text-left"},"Nomor Akta",-1)),t[8]||(t[8]=e("p",null,":",-1)),e("p",null,p(l.value.number||"Belum ada nomor"),1),t[9]||(t[9]=e("p",{class:"font-semibold text-left"},"Judul",-1)),t[10]||(t[10]=e("p",null,":",-1)),e("p",null,p(l.value.title),1),t[11]||(t[11]=e("p",{class:"font-semibold text-left"},"Jenis",-1)),t[12]||(t[12]=e("p",null,":",-1)),e("p",null,p(l.value.deedType),1),t[13]||(t[13]=e("p",{class:"font-semibold text-left"},"Deskripsi",-1)),t[14]||(t[14]=e("p",null,":",-1)),e("p",null,p(l.value.description),1),t[15]||(t[15]=e("p",{class:"font-semibold text-left"},"Tanggal",-1)),t[16]||(t[16]=e("p",null,":",-1)),e("p",null,p(l.value.deedDate),1),t[17]||(t[17]=e("p",{class:"font-semibold text-left"},"Status Saat Ini",-1)),t[18]||(t[18]=e("p",null,":",-1)),e("p",Me,p(_(l.value.deedStatus)),1)])])):y("",!0),e("div",Be,[C(E).isAdmin?(s(),a("div",Le,[((j=l.value)==null?void 0:j.deedStatus)===i[0]&&r.value.length<1?(s(),a("div",Fe," Menunggu klien mengupload dokumen ")):(((v=l.value)==null?void 0:v.deedStatus)===i[0]||((o=l.value)==null?void 0:o.deedStatus)===i[4])&&r.value.length>0?(s(),a("div",Je,[e("div",He,[(s(!0),a(O,null,M(r.value,b=>(s(),a("button",{key:b.id,class:"flex items-center gap-2 px-4 py-2 rounded border border-gray-400",disabled:""},[U(p(b.docType)+" ",1),b.status==="APPROVED"?(s(),T(G(n.CheckCircle),{key:0,class:"text-green-900"})):b.status==="REJECTED"?(s(),T(G(n.XCircle),{key:1,class:"text-red-800"})):(s(),T(G(n.FileText),{key:2}))]))),128))]),H(Ie,{deed:l.value,onSaved:c},null,8,["deed"])])):((d=l.value)==null?void 0:d.deedStatus)===i[1]?(s(),a("div",qe,[t[19]||(t[19]=e("h4",{class:"mb-3 text-lg font-medium text-gray-900"}," Siap untuk Proses Tanda Tangan ",-1)),D(e("textarea",{"onUpdate:modelValue":t[0]||(t[0]=b=>u.value=b),placeholder:"Catatan perubahan status (opsional)",class:"w-full border p-2 mb-3 rounded"},null,512),[[R,u.value]]),e("button",{onClick:t[1]||(t[1]=b=>k("WAITING_SIGNATURE")),class:"bg-green-600 text-white px-4 py-2 rounded disabled:opacity-50 disabled:cursor-not-allowed"}," Proses Tanda Tangan ")])):((h=l.value)==null?void 0:h.deedStatus)===i[2]?(s(),a("div",Ke,[t[20]||(t[20]=e("h3",{class:"mb-3 text-lg font-medium text-gray-900"},"Selesaikan Proses Akta",-1)),D(e("textarea",{"onUpdate:modelValue":t[2]||(t[2]=b=>u.value=b),placeholder:"Catatan perubahan status (opsional)",class:"w-full border p-2 mb-3 rounded"},null,512),[[R,u.value]]),e("button",{onClick:t[3]||(t[3]=b=>k("COMPLETED")),class:"bg-green-600 text-white px-4 py-2 rounded"}," Selesaikan Akta ")])):((A=l.value)==null?void 0:A.deedStatus)===i[3]?(s(),a("div",ze," Akta sudah selesai ")):((w=l.value)==null?void 0:w.deedStatus)===i[4]?(s(),a("div",We," Akta ini DITOLAK. ")):y("",!0)])):(s(),T(re,{key:1,documents:(B=l.value)==null?void 0:B.deedDocs},null,8,["documents"]))])]),e("div",Ze,[t[22]||(t[22]=e("h3",{class:"text-xl font-medium mb-2"},"Riwayat Status",-1)),e("ol",Xe,[(s(!0),a(O,null,M((L=l.value)==null?void 0:L.statusHistories,(b,q)=>(s(),a("li",{key:q,class:"ms-6 pb-4"},[t[21]||(t[21]=e("span",{class:"absolute flex items-center justify-center w-6 h-6 bg-blue-100 rounded-full -start-3 ring-8 ring-white dark:ring-gray-900 dark:bg-blue-900"},[e("svg",{class:"w-2.5 h-2.5 text-blue-800 dark:text-blue-300","aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{d:"M20 4a2 2 0 0 0-2-2h-2V1a1 1 0 0 0-2 0v1h-3V1a1 1 0 0 0-2 0v1H6V1a1 1 0 0 0-2 0v1H2a2 2 0 0 0-2 2v2h20V4ZM0 18a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8H0v10Zm5-8h10a1 1 0 0 1 0 2H5a1 1 0 0 1 0-2Z"})])],-1)),e("h3",Qe,p(_(b.status)),1),e("time",Ye,p(new Date(b.updatedAt).toLocaleString()),1),e("p",et,p(b.note),1)]))),128))])])])])}}};export{at as default};
